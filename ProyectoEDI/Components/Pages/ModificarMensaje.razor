@page "/modificar-mensaje/{id:int}"
@using Entities.Entidades_Definicion
@using Entities.Model.Enum
@inject NavigationManager NavigationManager
@rendermode InteractiveServer

<PageTitle>Modificar mensaje</PageTitle>

<div class="container d-flex justify-content-center align-items-center vh-100" style="margin-top:-100px">
    <div class="card p-4" style="width: 30rem;">
        <h2>Modificar Lista de Códigos</h2>
        <EditForm OnValidSubmit="Modificarmensaje">
            <DataAnnotationsValidator />
            <div class="mb-3">
                <label for="tipo" class="form-label">Tipo de Mensaje</label>
                <InputSelect @bind-Value="Mensaje.MessageType" class="form-select">
                    <option value="" disabled selected>Seleccione un tipo...</option>
                    @foreach (var tipo in Enum.GetValues(typeof(MessageTypeEnum)))
                    {
                        <option value="@tipo">@tipo</option>
                    }
                </InputSelect>
                <ValidationMessage For="@(() => Mensaje.MessageType)" />
                <!--
                <select class="form-select" id="tipo" @bind = "Mensaje.MessageType">
                    <option value="" disabled selected>Seleccione un tipo...</option>
                @foreach (var tipo in Enum.GetValues(typeof(MessageTypeEnum)))
                {
                        <option value="@tipo">@tipo</option>
                }
                </select>
                -->
            </div>

            <div class="mb-3">
                <label for="version" class="form-label">Versión:</label>
                <InputText type="text" class="form-control" id="version" name="version" @bind-value="Mensaje.MessageVersion" />
                <ValidationMessage For="@(() => Mensaje.MessageVersion)" />

            </div>

            <div class="mb-3">
                <label for="release" class="form-label">Release:</label>
                <InputText type="text" class="form-control" id="release" name="release" @bind-value="Mensaje.MessageRelease" />
                <ValidationMessage For="@(() => Mensaje.MessageRelease)" />
            </div>

            <div class="mb-3">
                <label for="directoryVersion" class="form-label">Directory Version:</label>
                <InputText type="text" class="form-control" id="directoryVersion" name="directoryVersion" @bind-value="Mensaje.MessageDirectoryVersion" />
                <ValidationMessage For="@(() => Mensaje.MessageDirectoryVersion)" />
            </div>

            <div class="mb-3">
                <label for="nombre" class="form-label">Nombre:</label>
                <InputText type="text" class="form-control" id="nombre" name="nombre" @bind-value="Mensaje.MessageName" />
                <ValidationMessage For="@(() => Mensaje.MessageName)" />
            </div>

            <div class="mb-3">
                <label for="descripcion" class="form-label">Descripcion:</label>
                <InputTextArea class="form-control" id="descripcion" name="descripcion" rows="3" style="max-height:200px" @bind-value="Mensaje.MessageDescription" />
                <ValidationMessage For="@(() => Mensaje.MessageDescription)" />
            </div>
            <div class="d-flex justify-content-center">
                <button type="submit" class="btn btn-danger">Guardar Cambios</button>
            </div>
        </EditForm>
    </div>
</div>

@code {
    [Parameter]
    public int Id { get; set; }

    private Message Mensaje = new Message();

    protected override void OnInitialized()
    {
        // Simular la carga de datos
        Mensaje = ListarMensaje.Messages.FirstOrDefault(c => c.MessageId == Id);
    }

    private void Modificarmensaje()
    {
        Console.WriteLine($"Mensaje modificado: {Mensaje.MessageName} - {Mensaje.MessageDescription}");
        var M = ListarMensaje.Messages.FirstOrDefault(c => c.MessageId == Id);
        if (M != null)
        {
            M.MessageType = Mensaje.MessageType;
            M.MessageVersion = Mensaje.MessageVersion;
            M.MessageRelease = Mensaje.MessageRelease;
            M.MessageDirectoryVersion = Mensaje.MessageDirectoryVersion;
            M.MessageName = Mensaje.MessageName;
            M.MessageDescription = Mensaje.MessageDescription;

            Console.WriteLine($"Mensaje modificado: {M.MessageName} - {M.MessageDescription}");
        }
        else
        {
            Console.WriteLine($"No se encontró unmensaje  con el ID: {Id} para modificar.");
        }

        //Redirigir al listado de mensajes
        NavigationManager.NavigateTo("/listar-mensaje");
    }
}